function AudioFileRequest(e,t){this.url=e,(t===void 0||null==t)&&(t=!0),this.async=t;var i=e.split(".");this.extension=i[i.length-1].toLowerCase()}function Decoder(){}function WAVDecoder(){}function AIFFDecoder(){}Gibberish={memo:{},functions:{},upvalues:[],codeblock:[],analysisCodeblock:[],analysisUgens:[],dirtied:[],id:0,isDirty:!1,out:null,debug:!1,callback:"",audioFiles:{},createCallback:function(){this.memo={},this.codeblock.length=0;for(var i=0;this.dirtied.length>i;i++)this.dirtied[i].codegen();if(this.dirtied.length=0,this.codestring=this.upvalues.join(""),this.codestring+="\nGibberish.callback = function() {\n	",this.memo={},this.out.getCodeblock(),this.codestring+=this.codeblock.join("	"),this.codestring+="\n	",this.codeblock.length=0,this.analysisUgens.length>0){this.analysisCodeblock.length=0;for(var i=0;this.analysisUgens.length>i;i++)this.codeblock.length=0,this.analysisUgens[i].codegen2(),this.codestring+=this.codeblock.join(""),this.codestring+="\n	",this.analysisCodeblock.push(this.analysisUgens[i].analysisCodegen());this.codestring+=this.analysisCodeblock.join("\n	"),this.codestring+="\n\n	"}this.codestring+="return "+this.out.variable+";\n",this.codestring+="}",this.callbackString=this.codestring,this.debug&&console.log(this.callbackString),eval(this.codestring)},audioProcess:function(e){for(var t=e.outputBuffer.getChannelData(0),i=e.outputBuffer.getChannelData(1),r=Gibberish,n=0,s=e.outputBuffer.length;s>n;n++){r.isDirty&&(r.createCallback(),r.isDirty=!1);var o=r.callback();t[n]=o[0],i[n]=o[1]}},audioProcessFirefox:function(e){for(var t=Gibberish,i=0,r=e.length;r>i;i+=2){t.isDirty&&(t.createCallback(),t.isDirty=!1);var n=t.callback();e[i]=n[0],e[i+1]=n[1]}},clear:function(){this.upvalues.length=1,this.out.inputs.length=0,this.analysisUgens.length=0,Gibberish.dirty(this.out)},dirty:function(e){if(e!==void 0){for(var t=!1,i=0;this.dirtied.length>i;i++)this.dirtied[i].variable===e.variable&&(t=!0);t||(this.isDirty=!0,this.dirtied.push(e))}else this.isDirty=!0},generateSymbol:function(e){return e+"_"+this.id++},AudioDataDestination:function(e,t){var i=new Audio;i.mozSetup(2,e);var r,n=0,s=e/2,o=null;setInterval(function(){var e;if(o){if(e=i.mozWriteAudio(o.subarray(r)),n+=e,r+=e,o.length>r)return;o=null}var a=i.mozCurrentSampleOffset(),h=a+s-n;if(h>0){var b=new Float32Array(h);t(b),e=i.mozWriteAudio(b),a=i.mozCurrentSampleOffset(),b.length>e&&(o=b,r=e),n+=e}},100)},init:function(){Gibberish.out=new Gibberish.Bus2,Gibberish.dirty(Gibberish.out);var e=arguments[0]===void 0?1024:arguments[0];return start=function(){if(-1===navigator.userAgent.indexOf("Firefox")){if(document.getElementsByTagName("body")[0].removeEventListener("touchstart",start),Gibberish.context=new webkitAudioContext,Gibberish.node=Gibberish.context.createJavaScriptNode(e,2,2,44100),Gibberish.node.onaudioprocess=Gibberish.audioProcess,Gibberish.node.connect(Gibberish.context.destination),"ontouchstart"in document.documentElement){var t=Gibberish.context.createBufferSource();t.connect(Gibberish.context.destination),t.noteOn(0)}}else Gibberish.AudioDataDestination(44100,Gibberish.audioProcessFirefox)},"ontouchstart"in document.documentElement?document.getElementsByTagName("body")[0].addEventListener("touchstart",start):start(),this},makePanner:function(){var e=Math.sin,t=Math.cos,i=Math.sqrt(2)/2,r=function(r,n,s){var o="object"==typeof r,a=o?r[0]:r,h=o?r[1]:r;return s[0]=a*i*(t(n)-e(n)),s[1]=h*i*(t(n)+e(n)),s};return r},polyInit:function(e){e.mod=e.polyMod,e.removeMod=e.removePolyMod;for(var t in e.polyProperties)(function(t){var i=e.polyProperties[t];Object.defineProperty(e,t,{get:function(){return i},set:function(r){i=r;for(var n=0;e.children.length>n;n++)e.children[n][t]=i}})})(t)},interpolate:function(){var e=Math.floor;return function(t,i){var r=e(i),n=r+1,s=i-r;return n=t.length>n?n:0,t[r]*(1-s)+t[n]*s}}(),"export":function(e,t){for(var i in Gibberish[e])console.log("exporting",i,"from",e),t[i]=Gibberish[e][i]},ugen:function(){Gibberish.extend(this,{processProperties:function(){if("object"!=typeof arguments[0][0]||arguments[0][0].type!==void 0||Array.isArray(arguments[0][0])){var e=0;for(var t in this.properties)"object"==typeof this.properties[t]&&this.properties[t].binops!==void 0?arguments[0][e]!==void 0&&(this.properties[t].value=arguments[0][e++]):arguments[0][e]!==void 0&&(this.properties[t]=arguments[0][e++])}else{var i=arguments[0][0];for(var t in i)i[t]!==void 0&&("object"==typeof this.properties[t]&&this.properties[t].binops!==void 0?this.properties[t].value=i[t]:this[t]=i[t])}return this},codegen:function(){var e="",t=null;if(Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];t=this.variable?this.variable:Gibberish.generateSymbol("v"),Gibberish.memo[this.symbol]=t,this.variable=t,e+="var "+t+" = "+this.symbol+"(";for(var i in this.properties){var r=this.properties[i],n="";if("single_sample_delay"===this.name&&console.log("SSD PROP"+i),Array.isArray(r.value)){0===r.value.length&&(n=0);for(var s=0;r.value.length>s;s++){var o=r.value[s];n+="object"==typeof o?null!==o?o.codegen():"null":o,n+=r.value.length-1>s?", ":""}}else n="object"==typeof r.value?null!==r.value?r.value.codegen():"null":r.value;if(e+=n,r.binops)for(var a=0;r.binops.length>a;a++){var h,b=r.binops[a];h="number"==typeof b.ugen?b.ugen:null!==b.ugen?b.ugen.codegen():"null","="===b.binop?(e=e.replace(n,""),e+=h):"++"===b.binop?(Gibberish.upvalues.push("var abs = Math.abs\n;"),e+=" + abs("+h+")"):e+=" "+b.binop+" "+h}e+=", "}return" "===e.charAt(e.length-1)&&(e=e.slice(0,-2)),e+=");\n",null===this.codeblock&&Gibberish.upvalues.pushUnique("var "+this.symbol+" = Gibberish.functions."+this.symbol+";\n"),this.codeblock=e,this.dirty=!1,t},getCodeblock:function(){if(null!==this&&(null===this.codeblock&&this.codegen(),!Gibberish.memo[this.symbol])){if(Gibberish.memo[this.symbol]=this.variable,"analysis"!==this.type)for(var e in this.properties){var t=this.properties[e];if(Array.isArray(t.value))for(var i=t.value,r=0;i.length>r;r++){var n=i[r];"object"==typeof n&&null!==n&&n.getCodeblock()}else"object"==typeof t.value&&null!==t.value&&t.value.getCodeblock();if(t.binops)for(var s=0;t.binops.length>s;s++){var o=t.binops[s];"object"==typeof o.ugen&&null!==o.ugen&&o.ugen.getCodeblock()}}return"analysis"===this.type?Gibberish.codeblock.unshift(this.codeblock):Gibberish.codeblock.push(this.codeblock),this.variable}},defineUgenProperty:function(e,t){this.properties[e]={symbol:Gibberish.generateSymbol("v"),value:t,binops:[],getCodeblock:function(){"number"!=typeof this.value&&Gibberish.codeblock.push("var "+this.symbol+" = "+this.value+";\n")},codegen:function(){return"number"==typeof this.value||"string"==typeof this.value?this.value:this.symbol},parent:this,name:e},function(t){var i=e;Object.defineProperty(t,i,{configurable:!0,get:function(){return t.properties[i].value},set:function(e){t.properties[i].value=e,Gibberish.dirty(t)}})}(this)},init:function(){if(this.initalized||(this.symbol=Gibberish.generateSymbol(this.name),this.codeblock=null,this.variable=null),this.properties===void 0&&(this.properties={}),!this.initialized){this.destinations=[];for(var e in this.properties)this.defineUgenProperty(e,this.properties[e])}if(arguments.length>0&&"object"==typeof arguments[0][0]&&"undefined"===arguments[0][0].type){var t=arguments[0][0];for(var e in t)this[e]=t[e]}return Gibberish.functions[this.symbol]=this.callback,this.initialized=!0,this},mod:function(e,t,i){var r=this.properties[e],n={ugen:t,binop:i};r.binops.push(n),Gibberish.dirty(this)},removeMod:function(e,t){if(t===void 0)this.properties[e].binops.length=0;else if("number"==typeof t)this.properties[e].binops.splice(t,1);else if("object"==typeof t)for(var i=0,r=this.properties[e].binops.length;r>i;i++)this.properties[e].binops[i].ugen===t&&this.properties[e].binops.splice(i,1);Gibberish.dirty(this)},polyMod:function(e,t,i){for(var r=0;this.children.length>r;r++)this.children[r].mod(e,t,i);Gibberish.dirty(this)},removePolyMod:function(){var e=Array.prototype.slice.call(arguments,0);if("amp"!==arguments[0]&&"pan"!==arguments[0])for(var t=0;this.children.length>t;t++)this.children[t].removeMod.apply(this.children[t],e);else this.removeMod.apply(this,e);Gibberish.dirty(this)},smooth:function(e){var t=new Gibberish.OnePole;this.mod(e,t,"=")},connect:function(e){return e===void 0&&(e=Gibberish.out),-1===this.destinations.indexOf(e)&&(e.addConnection(this,1),this.destinations.push(e)),this},send:function(e,t){return-1===this.destinations.indexOf(e)?(e.addConnection(this,t),this.destinations.push(e)):e.adjustSendAmount(this,t),this},disconnect:function(e){if(e===void 0)for(var t=0;this.destinations.length>t;t++)this.destinations[t].removeConnection(this),this.destiGibbenations.splice(t);else e.removeConnection(this);return this}})}},Array2=function(){this.length=0},Array2.prototype=[],Array2.prototype.remove=function(e,t){if(t=t===void 0?!0:t,e===void 0){for(var i=0;this.length>i;i++)delete this[i];this.length=0}else if("number"==typeof e)this.splice(e,1);else if("string"==typeof e){for(var r=[],i=0;this.length>i;i++){var n=this[i];if(n.type===e||n.name===e){if(!t)return this.splice(i,1),void 0;r.push(i)}}for(var i=0;r.length>i;i++)this.splice(r[i],1)}else if("object"==typeof e)for(var s=this.indexOf(e);s>-1;)this.splice(s,1),s=this.indexOf(e);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.get=function(e){if("number"==typeof e)return this[e];if("string"==typeof e)for(var t=0;this.length>t;t++){var i=this[t];if(i.name===e)return i}else if("object"==typeof e){var r=this.indexOf(e);if(r>-1)return this[r]}return null},Array2.prototype.replace=function(e,t){if(t.parent=this,t.input=e.input,"number"!=typeof e){var i=this.indexOf(e);i>-1&&this.splice(i,1,t)}else this.splice(e,1,t);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.insert=function(e,t){if(e.parent=this,this.input=this.parent,Array.isArray(e))for(var i=0;e.length>i;i++)this.splice(t+i,0,e[i]);else this.splice(t,0,e);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.add=function(){for(var e=0;arguments.length>e;e++)arguments[e].parent=this,arguments[e].input=this.parent,this.push(arguments[e]);this.parent&&(console.log("DIRTYING"),Gibberish.dirty(this.parent))},Array.prototype.pushUnique=function(){for(var e=0;arguments.length>e;e++){for(var t=arguments[e],i=!0,r=0;this.length>r;r++)if(t===this[r]){i=!1;break}i&&this.push(t)}};var rnd=Math.random;Gibberish.rndf=function(e,t,i,r){if(r=r===void 0?!0:r,i===void 0&&"object"!=typeof e){1==arguments.length?(e=0,t=arguments[0]):2==arguments.length?(e=arguments[0],t=arguments[1]):(e=0,t=1);var n=t-e,s=rnd(),o=n*s;return e+o}var a=[],h=[];i===void 0&&(i=t||e.length);for(var b=0;i>b;b++){var l;if("object"==typeof arguments[0])l=arguments[0][randomi(0,arguments[0].length-1)];else if(r)l=Gibberish.rndf(e,t);else{for(l=Gibberish.rndf(e,t);h.indexOf(l)>-1;)l=Gibberish.rndf(e,t);h.push(l)}a.push(l)}return a},Gibberish.extend=function(e,t){for(var i in t)i.split("."),t[i]instanceof Array&&100>t[i].length?(e[i]=t[i].slice(0),"fx"===i&&(e[i].parent=t[i].parent)):"object"!=typeof t[i]||null===t[i]||t[i]instanceof Float32Array?e[i]=t[i]:(e[i]=e[i]||{},arguments.callee(e[i],t[i]));return e},Function.prototype.clone=function(){return eval("["+(""+this)+"]")[0]},String.prototype.format=function(e,t,i){function r(){var r=this,n=arguments.length+1;for(e=0;n>e;i=arguments[e++])t=i,r=r.replace(RegExp("\\{"+(e-1)+"\\}","g"),t);return r}return r.native=String.prototype.format,r}(),Gibberish.Proxy=function(){var e=0;Gibberish.extend(this,{name:"proxy",type:"effect",properties:{},callback:function(){return e}}).init(),this.input=arguments[0],e=this.input.parent[this.input.name],delete this.input.parent[this.input.name],this.input.parent.properties[this.input.name].value=this,Object.defineProperty(this.input.parent,this.input.name,{get:function(){return e},set:function(t){e=t}}),Gibberish.dirty(this.input.parent)},Gibberish.Proxy.prototype=new Gibberish.ugen,Gibberish.oscillator=function(){this.type="oscillator",this.oscillatorInit=function(){return this.fx=new Array2,this.fx.parent=this,this}},Gibberish.oscillator.prototype=new Gibberish.ugen,Gibberish._oscillator=new Gibberish.oscillator,Gibberish.Sine=function(){this.name="sine",this.properties={frequency:arguments[0]||440,amp:arguments[1]||.5};var e=2*Math.PI,t=Math.sin,i=0;this.callback=function(r,n){return i+=r/44100,t(i*e)*n},this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Sine.prototype=Gibberish._oscillator,Gibberish.Sine2=function(){this.__proto__=new Gibberish.Sine,this.name="sine2",this.defineUgenProperty("pan",0);var e=this.__proto__.callback,t=Gibberish.makePanner(),i=[0,0];this.callback=function(r,n,s){var o=e(r,n);return i=t(o,s,i)},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw=function(){this.name="saw",this.properties={frequency:440,amp:.15};var e=0;this.callback=function(t,i){var r=4*((e/2+.25)%.5-.25);return r*=i,e+=t/44100,e=e>1?e%1:e,r},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw.prototype=Gibberish._oscillator,Gibberish.Saw2=function(){this.__proto__=new Gibberish.Saw,this.name="saw2",this.defineUgenProperty("pan",0);var e=this.__proto__.callback,t=Gibberish.makePanner(),i=[0,0];this.callback=function(r,n,s){var o=e(r,n);return i=t(o,s,i)},this.init()},Gibberish.Triangle=function(){var e=0,t=Math.abs;Gibberish.extend(this,{name:"triangle",properties:{frequency:440,amp:.15},callback:function(i,r){var n=1-4*t((e+.25)%1-.5);return n*=r,e+=i/44100,e=e>1?e%1:e,n}}).init().oscillatorInit().processProperties(arguments)},Gibberish.Triangle.prototype=Gibberish._oscillator,Gibberish.Triangle2=function(){this.__proto__=new Gibberish.Triangle,this.name="triangle2",this.defineUgenProperty("pan",0);var e=this.__proto__.callback,t=Gibberish.makePanner(),i=[0,0];this.callback=function(r,n,s){var o=e(r,n);return t(o,s,i)},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw3=function(){var e=0,t=0,i=2.5,r=-1.5,n=0,s=Math.sin,o=11;pi_2=2*Math.PI,Gibberish.extend(this,{name:"saw",properties:{frequency:440,amp:.15},callback:function(a){var h=a/44100,b=.5-h,l=o*b*b*b*b,u=.376-.752*h,p=1-2*h,c=0;return t+=h,t-=t>1?2:0,e=.5*(e+s(pi_2*(t+e*l))),c=i*e+r*n,n=e,c+=u,c*p}}),Object.defineProperty(this,"scale",{get:function(){return o},set:function(e){o=e}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw3.prototype=Gibberish._oscillator,Gibberish.PWM=function(){var e=0,t=0,i=0,r=0,n=0,s=2.5,o=-1.5,a=Math.sin,h=11;pi_2=2*Math.PI,test=0,Gibberish.extend(this,{name:"pwm",properties:{frequency:440,amp:.15,pulsewidth:.5},callback:function(b,l,u){var p=b/44100,c=.5-p,d=h*c*c*c*c,f=1-2*p,m=0;return n+=p,n-=n>1?2:0,e=.5*(e+a(pi_2*(n+e*d))),t=.5*(t+a(pi_2*(n+t*d+u))),m=t-e,m=s*m+o*(i-r),i=e,r=t,m*f*l}}),Object.defineProperty(this,"scale",{get:function(){return h},set:function(e){h=e}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.PWM.prototype=Gibberish._oscillator,Gibberish.Noise=function(){var e=Math.random;Gibberish.extend(this,{name:"noise",properties:{amp:1},callback:function(t){return(2*e()-1)*t}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Noise.prototype=Gibberish._oscillator,Gibberish.KarplusStrong=function(){var e=[0],t=0,i=Math.random,r=Gibberish.makePanner(),n=[0,0];Gibberish.extend(this,{name:"karplus_strong",properties:{blend:1,damping:0,amp:1,channels:2,pan:0},note:function(t){var r=Math.floor(44100/t);e.length=0;for(var n=0;r>n;n++)e[n]=2*i()-1},callback:function(s,o,a,h,b){var l=e.shift(),u=i()>s?-1:1;o=o>0?o:0;var p=u*(l+t)*(.5-o/100);return t=p,e.push(p),p*=a,1===h?p:r(p,b,n)}}).init().oscillatorInit().processProperties(arguments)},Gibberish.KarplusStrong.prototype=Gibberish._oscillator,Gibberish.PolyKarplusStrong=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"poly_karplus_strong",maxVoices:5,voiceCount:0,polyProperties:{blend:1,damping:0},note:function(e,t){var i=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),i.note(e,t)}}),this.amp=1/this.maxVoices,this.processProperties(arguments),this.children=[],this.dirty=!0;for(var e=0;this.maxVoices>e;e++){var t={blend:this.blend,damping:this.damping,channels:2,amp:1},i=new Gibberish.KarplusStrong(t).connect(this);this.children.push(i)}Gibberish.polyInit(this),Gibberish._synth.oscillatorInit.call(this)},Gibberish.bus=function(){this.type="bus",this.inputCodegen=function(){var e=this.value.codegen(),t=1===this.amp?e:e+" * "+this.amp;return this.codeblock=t,t},this.addConnection=function(){var e={value:arguments[0],amp:arguments[1],codegen:this.inputCodegen};e.getCodeblock=e.value.getCodeblock.bind(e.value),this.inputs.push(e),Gibberish.dirty(this)},this.removeConnection=function(e){for(var t=0;this.inputs.length>t;t++)if(this.inputs[t].value===e){this.inputs.splice(t,1),Gibberish.dirty(this);break}},this.adjustSendAmount=function(e,t){for(var i=0;this.inputs.length>i;i++)if(this.inputs[i].value===e){this.inputs[i].amp=t,Gibberish.dirty(this);break}},this.callback=function(){var e=arguments[arguments.length-2],t=arguments[arguments.length-1];output[0]=output[1]=0;for(var i=0;arguments.length-2>i;i++){var r="object"==typeof arguments[i];output[0]+=r?arguments[i][0]:arguments[i],output[1]+=r?arguments[i][1]:arguments[i]}return output[0]*=e,output[1]*=e,panner(output,t,output)}},Gibberish.bus.prototype=new Gibberish.ugen,Gibberish._bus=new Gibberish.bus,Gibberish.Bus=function(){return Gibberish.extend(this,{name:"bus",properties:{inputs:[],amp:arguments[1]||1},callback:function(){for(var e=0,t=arguments.length-1,i=arguments[t],r=0;t>r;r++)e+=args[r];return e*=i}}),this.init(),this},Gibberish.Bus.prototype=Gibberish._bus,Gibberish.Bus2=function(){this.name="bus2",this.type="bus",this.properties={inputs:[],amp:arguments[1]||1,pan:0};var e=[0,0],t=Gibberish.makePanner();this.callback=function(){var i=arguments[arguments.length-2],r=arguments[arguments.length-1];e[0]=e[1]=0;for(var n=0;arguments.length-2>n;n++){var s="object"==typeof arguments[n];e[0]+=s?arguments[n][0]:arguments[n],e[1]+=s?arguments[n][1]:arguments[n]}return e[0]*=i,e[1]*=i,t(e,r,e)},this.initialized=!1,this.init()},Gibberish.Bus2.prototype=Gibberish._bus,Gibberish.envelope=function(){this.type="envelope"},Gibberish.envelope.prototype=new Gibberish.ugen,Gibberish._envelope=new Gibberish.envelope,Gibberish.Line=function(e,t,i,r){var n={name:"line",properties:{start:e||0,end:isNaN(t)?1:t,time:i||44100,loops:r||!1}},s=0,o=(t-e)/i;return this.callback=function(e,t,i,r){var n=i>s?e+s++*o:t;return s=n>=t&&r?0:s,n},Gibberish.extend(this,n),this.init(),this},Gibberish.Line.prototype=Gibberish._envelope,Gibberish.AD=function(e,t){var i=0,r=0;Gibberish.extend(this,{name:"AD",properties:{attack:e||1e4,decay:t||1e4},run:function(){return r=0,i=0,this},callback:function(e,t){if(e=0>e?_4:e,t=0>t?_4:t,0===r){var n=1/e;i+=n,i>=1&&r++}else if(1===r){var n=1/t;i-=n,0>=i&&(i=0,r++)}return i},getState:function(){return r}}).init().processProperties(arguments)},Gibberish.AD.prototype=Gibberish._envelope,Gibberish.ADSR=function(e,t,i,r,n,s){var o={name:"adsr",type:"envelope",properties:{attack:isNaN(e)?1e4:e,decay:isNaN(t)?1e4:t,release:isNaN(r)?1e4:r,sustain:i===void 0?88200:i,attackLevel:n||1,sustainLevel:s||.5},run:function(){this.setPhase(0),this.setState(0)}};Gibberish.extend(this,o);var a=0,h=0;return this.callback=function(e,t,i,r,n,s){var o=0;return 0===h?(o=a/e*n,1===++a/e&&(h++,a=t)):1===h?(o=a/t*(n-s)+s,0>=--a&&(null!==i?(h+=1,a=i):(h+=2,a=r))):2===h?(o=s,0===a--&&(h++,a=r)):3===h&&(a--,o=a/r*s,0>=a&&h++),o},this.setPhase=function(e){a=e},this.setState=function(e){h=e,a=0},this.getState=function(){return h},this.init(),this},Gibberish.ADSR.prototype=Gibberish._envelope,Gibberish.analysis=function(){this.type="analysis",this.codegen=function(){return Gibberish.memo[this.symbol]?Gibberish.memo[this.symbol]:(v=this.variable?this.variable:Gibberish.generateSymbol("v"),Gibberish.memo[this.symbol]=v,this.variable=v,Gibberish.upvalues.push("var "+this.symbol+" = Gibberish.functions."+this.symbol+";\n"),this.codeblock="var "+this.variable+" = "+this.symbol+"();\n",this.variable)},this.codegen2=function(){for(var e in this.properties){var t=this.properties[e];if(Array.isArray(t.value))for(var i=0;t.value.length>i;i++){var r=t.value[i];"object"==typeof r&&(r.type="ddd",r.codegen(),r.getCodeblock(),r.type="analysis")}else if("object"==typeof t.value&&!Gibberish.memo[t.value.symbol]){t.value.type="ddd",t.value.codegen(),t.value.getCodeblock(),Gibberish.codeblock.push(t.value.codeblock),t.value.type="analysis";var n=t.value.variable?t.value.variable:Gibberish.generateSymbol("v");Gibberish.memo[t.value.symbol]=n,t.value.variable=n,Gibberish.codestring="var "+t.value.symbol+" = Gibberish.functions."+t.value.symbol+";\n"+Gibberish.codestring}if(t.binops)for(var s=0;t.binops.length>s;s++){var o=t.binops[s];"object"==typeof o.ugen&&o.ugen.codegen()}}},this.analysisCodegen=function(){var e=this.analysisSymbol+"("+this.input.variable+",";for(var t in this.properties)"input"!==t&&(e+=this[t]+",");return e=e.slice(0,-1),e+=");",this.analysisCodeblock=e,e},this.analysisInit=function(){this.analysisSymbol=Gibberish.generateSymbol(this.name),Gibberish.functions[this.analysisSymbol]=this.analysisCallback,Gibberish.upvalues.push("var "+this.analysisSymbol+" = Gibberish.functions."+this.analysisSymbol+";\n"),Gibberish.analysisUgens.push(this)}},Gibberish.analysis.prototype=new Gibberish.ugen,Gibberish._analysis=new Gibberish.analysis,Gibberish.Follow=function(){this.name="follow",this.properties={mult:1,input:0,bufferSize:4410};var e=Math.abs,t=[0],i=0,r=0,n=0;this.analysisCallback=function(s,o,a){i+=e(s),i-=t[r],t[r]=e(s),r=(r+1)%o,t[r]=t[r]?t[r]:0,n=i/o*a},this.callback=function(){return n},this.init()},Gibberish.Follow.prototype=Gibberish._analysis,Gibberish.SingleSampleDelay=function(){this.name="single_sample_delay",this.properties={input:arguments[0]||0,amp:arguments[1]||1};var e=0;this.analysisCallback=function(t,i){e="object"==typeof t?"object"==typeof t?[t[0]*i,t[1]*i]:t*i:t*i},this.callback=function(){return e},this.init(),this.analysisInit()},Gibberish.SingleSampleDelay.prototype=Gibberish._analysis,Gibberish.Record=function(e,t,i){var r=new Float32Array(t),n=0,s=!1,o=this;Gibberish.extend(this,{name:"record",oncomplete:i,properties:{input:0,size:t||0},analysisCallback:function(e,t){s&&(r[n++]="object"==typeof e?e[0]+e[1]:e,n>=t&&(s=!1,o.remove()))},record:function(){return n=0,s=!0,this},getBuffer:function(){return r},getPhase:function(){return n},remove:function(){this.oncomplete!==void 0&&this.oncomplete();for(var e=0;Gibberish.analysisUgens.length>e;e++){var t=Gibberish.analysisUgens[e];if(t===this)return Gibberish.analysisUgens.splice(e,1),void 0}}}),this.properties.input=e,this.init(),this.analysisInit(),Gibberish.dirty()},Gibberish.Record.prototype=Gibberish._analysis,Gibberish.effect=function(){this.type="effect"},Gibberish.effect.prototype=new Gibberish.ugen,Gibberish._effect=new Gibberish.effect,Gibberish.Distortion=function(){var e=Math.abs,t=Math.log,i=Math.LN2;Gibberish.extend(this,{name:"distortion",properties:{input:0,amount:50},callback:function(r,n){var s;return"number"==typeof r?(s=r*n,r=s/(1+e(s))/(t(n)/i)):(s=r[0]*n,r[0]=s/(1+e(s))/(t(n)/i),s=r[1]*n,r[1]=s/(1+e(s))/(t(n)/i)),r}}).init().processProperties(arguments)},Gibberish.Distortion.prototype=Gibberish._effect,Gibberish.Delay=function(){var e=[],t=0;e.push(new Float32Array(88200)),e.push(new Float32Array(88200)),Gibberish.extend(this,{name:"Delay",properties:{input:0,time:22050,feedback:.5,channels:1},callback:function(i,r,n){var s="number"==typeof i?1:2,o=t++%88200,a=(o+r)%88200;return 1===s?(e[0][a]=(i+e[0][o])*n,i+=e[0][o]):(e[0][a]=(i[0]+e[0][o])*n,i[0]+=e[0][o],e[1][a]=(i[1]+e[1][o])*n,i[1]+=e[1][o]),i}}).init().processProperties(arguments)},Gibberish.Delay.prototype=Gibberish._effect,Gibberish.Decimator=function(){var e=0,t=[],i=Math.pow,r=Math.floor;Gibberish.extend(this,{name:"Decimator",properties:{input:0,bitDepth:16,sampleRate:1},callback:function(n,s,o){e+=o;var a="number"==typeof n?1:2;if(1===a){if(e>=1){var h=i(s,2);t[0]=r(n*h)/h,e-=1}n=t[0]}else{if(e>=1){var h=i(s,2);t[0]=r(n[0]*h)/h,t[1]=r(n[1]*h)/h,e-=1}n=t}return n}}).init().processProperties(arguments)},Gibberish.Decimator.prototype=Gibberish._effect,Gibberish.RingModulation=function(){var e=(new Gibberish.Sine).callback,t=[0,0];Gibberish.extend(this,{name:"ringmod",properties:{input:0,frequency:440,amp:.5,mix:.5},callback:function(i,r,n,s){var o="number"==typeof i?1:2,a=1===o?i:i[0],h=e(r,n);if(a=a*(1-s)+a*h*s,2===o){var b=i[1];return b=b*(1-s)+b*h*s,t[0]=a,t[1]=b,t}return a}}).init().processProperties(arguments)},Gibberish.RingModulation.prototype=Gibberish._effect,Gibberish.OnePole=function(){var e=0;Gibberish.extend(this,{name:"onepole",type:"effect",properties:{input:null,a0:.15,b1:.85},callback:function(t,i,r){var n=t*i+e*r;return e=n,n},smooth:function(e,t){this.input=t.properties[e],t.mod(e,this,"=")}}).init().processProperties(arguments)},Gibberish.OnePole.prototype=Gibberish._effect,Gibberish.Filter24=function(){var e=[0,0,0,0],t=[0,0,0,0],i=[0,0],r=isNaN(arguments[0])?.1:arguments[0],n=isNaN(arguments[1])?3:arguments[1];_isLowPass=arguments[2]!==void 0?arguments[2]:!0,Gibberish.extend(this,{name:"filter24",properties:{input:0,cutoff:r,resonance:n,isLowPass:_isLowPass},callback:function(r,n,s,o){var a="number"==typeof r?1:2,h=1===a?r:r[0],b=e[3]*s;if(b=b>1?1:b,n=0>n?0:n,n=n>1?1:n,h-=b,e[0]=e[0]+(-e[0]+h)*n,e[1]=e[1]+(-e[1]+e[0])*n,e[2]=e[2]+(-e[2]+e[1])*n,e[3]=e[3]+(-e[3]+e[2])*n,h=o?e[3]:h-e[3],2===a){var l=r[1];return b=t[3]*s,b=b>1?1:b,l-=b,t[0]=t[0]+(-t[0]+l)*n,t[1]=t[1]+(-t[1]+t[0])*n,t[2]=t[2]+(-t[2]+t[1])*n,t[3]=t[3]+(-t[3]+t[2])*n,l=o?t[3]:l-t[3],i[0]=h,i[1]=h,i}return h}}).init().processProperties(arguments)},Gibberish.Filter24.prototype=Gibberish._effect,Gibberish.SVF=function(){var e=[0,0],t=[0,0],i=Math.PI,r=[0,0];Gibberish.extend(this,{name:"SVF",properties:{input:0,cutoff:440,Q:2,mode:0},callback:function(n,s,o,a){var h="number"==typeof n?1:2,b=1===h?n:n[0],l=2*i*s/44100;o=1/o;var u=t[0]+l*e[0],p=b-u-o*e[0],c=l*p+e[0],d=p+u;if(e[0]=c,t[0]=u,b=0===a?u:1===a?p:2===a?c:d,2===h){var f=n[1],u=t[1]+l*e[1],p=f-u-o*e[1],c=l*p+e[1],d=p+u;e[1]=c,t[1]=u,f=0===a?u:1===a?p:2===a?c:d,r[0]=b,r[1]=f}else r=b;return r}}).init().processProperties(arguments)},Gibberish.SVF.prototype=Gibberish._effect,Gibberish.Biquad=function(){var e=[0,0],t=[0,0],i=[0,0],r=[0,0],n=[0,0];Gibberish.extend(this,{name:"biquad",mode:"LP",cutoff:2e3,Q:.5,properties:{input:null,b0:.001639,b1:.003278,b2:.001639,a1:-1.955777,a2:.960601},calculateCoefficients:function(){switch(this.mode){case"LP":var e=2*Math.PI*this.cutoff/44100,t=Math.sin(e),i=Math.cos(e),r=t/(2*this.Q),n=(1-i)/2,s=1-i,o=n,a=1+r,h=-2*i,b=1-r;break;case"HP":var e=2*Math.PI*this.cutoff/44100,t=Math.sin(e),i=Math.cos(e),r=t/(2*this.Q),n=(1+i)/2,s=-(1+i),o=n,a=1+r,h=-2*i,b=1-r;break;case"BP":var e=2*Math.PI*this.cutoff/44100,t=Math.sin(e),i=Math.cos(e),l=Math.log(2)/2*this.Q*e/t,r=t*(Math.exp(l)-Math.exp(-l))/2,n=r,s=0,o=-r,a=1+r,h=-2*i,b=1-r;break;default:return}this.b0=n/a,this.b1=s/a,this.b2=o/a,this.a1=h/a,this.a2=b/a},call:function(e){return this.function(e,this.b0,this.b1,this.b2,this.a1,this.a2)},callback:function(s,o,a,h,b,l){var u="number"==typeof s?1:2,p=0,c=0,d=1===u?s:s[0];return p=o*d+a*e[0]+h*t[0]-b*i[0]-l*r[0],t[0]=e[0],e[0]=s[0],r[0]=i[0],i[0]=p,2===u&&(inR=s[1],c=o*inR+a*e[1]+h*t[1]-b*i[1]-l*r[1],t[1]=e[1],e[1]=s[1],r[1]=i[1],i[1]=c,n[0]=p,n[1]=c),1===u?p:n}}).init().processProperties(arguments),this.calculateCoefficients()},Gibberish.Biquad.prototype=Gibberish._effect,Gibberish.Flanger=function(){var e=[new Float32Array(88200),new Float32Array(88200)],t=88200,i=(new Gibberish.Sine).callback,r=Gibberish.interpolate,n=-100,s=0;Gibberish.extend(this,{name:"flanger",properties:{input:0,rate:.25,amount:125,feedback:0,offset:125},callback:function(o,a,h,b,l,u){var u="number"==typeof o?1:2,p=n+i(a,.95*h);p>t?p-=t:0>p&&(p+=t);var c=r(e[0],p);return e[0][s]=1===u?o+c*b:o[0]+c*b,2===u?(o[0]+=c,c=r(e[1],p),e[1][s]=o[1]+c*b,o[1]+=c):o+=c,++s>=t&&(s=0),++n>=t&&(n=0),o}}).init().processProperties(arguments),n=-1*this.offset},Gibberish.Flanger.prototype=Gibberish._effect,Gibberish.Vibrato=function(){var e=[new Float32Array(88200),new Float32Array(88200)],t=88200,i=(new Gibberish.Sine).callback,r=Gibberish.interpolate,n=-100,s=0;Gibberish.extend(this,{name:"vibrato",properties:{input:0,rate:5,amount:.5,offset:125},callback:function(o,a,h,b,l){var l="number"==typeof o?1:2,u=n+i(a,h*b-1);u>t?u-=t:0>u&&(u+=t);var p=r(e[0],u);return e[0][s]=1===l?o:o[0],2===l?(o[0]=p,p=r(e[1],u),e[1][s]=o[1],o[1]=p):o=p,++s>=t&&(s=0),++n>=t&&(n=0),o}}).init().processProperties(arguments),n=-1*this.offset},Gibberish.Vibrato.prototype=Gibberish._effect,Gibberish.BufferShuffler=function(){var e=[new Float32Array(88200),new Float32Array(88200)],t=88200,i=0,r=0,n=0,s=0,o=0,a=Math.random,h=1,b=!1,l=!1,u=!1,p=Gibberish.interpolate,c=!1,d=1,f=!1,m=Gibberish.rndf,g=[0,0];Gibberish.extend(this,{name:"buffer_shuffler",properties:{input:0,chance:.25,rate:11025,length:22050,reverseChange:.5,pitchChance:.5,pitchMin:.25,pitchMax:2,wet:1,dry:0},callback:function(y,v,G,k,w,_,P,S,A,x){var M="number"==typeof y?1:2;o?0===++s%(k-400)&&(b=!1,l=!0,h=1,s=0):(e[0][r]=1===M?y:y[0],e[1][r]=1===M?y:y[1],r++,r%=t,f=0===r?1:f,n++,0==n%G&&v>a()&&(u=w>a(),o=!0,u||(i=r-k,0>i&&(i=t+i)),c=_>a(),c&&(d=m(P,S)),h=1,b=!0,l=!1)),i+=u?-1*d:d,0>i?i+=t:i>t&&(i-=t);var C,F,I,D,j=p(e[0],i);return b?(h-=.0025,I=j*(1-h),C=1===M?I+y*h:I+y[0]*h,2===M&&(D=p(e[1],i),I=D*(1-h),F=1===M?C:I+y[1]*h),.0025>=h&&(b=!1)):l?(h-=.0025,I=j*h,C=1===M?I+y*h:I+y[0]*(1-h),2===M&&(D=p(e[1],i),I=D*h,F=I+y[1]*(1-h)),.0025>=h&&(l=!1,o=!1,u=!1,d=1,c=0)):1===M?C=o&&f?j*A+y*x:y:(D=p(e[1],i),C=o&&f?j*A+y[0]*x:y[0],F=o&&f?D*A+y[1]*x:y[1]),g=[C,F],1===M?C:g}}).init().processProperties(arguments)},Gibberish.BufferShuffler.prototype=Gibberish._effect,Gibberish.AllPass=function(e){var t=-1,i=new Float32Array(e||500),r=i.length;Gibberish.extend(this,{name:"allpass",properties:{input:0},callback:function(e){t=++t%r;var n=i[t],s=-1*e+n;return i[t]=e+.5*n,s}})},Gibberish.Comb=function(e){var t=new Float32Array(e||1200),i=t.length,r=0,n=0;Gibberish.extend(this,{name:"comb",properties:{input:0,time:e||1200},callback:function(e){var s=++r%i,o=t[s];return n=.8*o+.2*n,t[s]=e+.84*n,o}})},Gibberish.Reverb=function(){var e={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.9,scaleRoom:.28,offsetRoom:.7,stereoSpread:23},t=[],i=[],r=[0,0];Gibberish.extend(this,{name:"Reverb",roomSize:.5,damping:.2223,properties:{input:0,wet:.5,dry:.55},callback:function(e,n,s){for(var o="object"==typeof e?2:1,a=1===o?e:e[0]+e[1],h=.015*a,b=h,l=0;8>l;l++){var u=t[l](h);b+=u}for(var l=0;4>l;l++)b=i[l](b);return r[0]=r[1]=a*s+b*n,r}}).init().processProperties(arguments);for(var n=0;8>n;n++)t.push(new Gibberish.Comb(e.combTuning[n],this.roomSize*e.scaleRoom*e.offsetRoom,this.damping).callback);for(var n=0;4>n;n++)i.push(new Gibberish.AllPass(e.allPassTuning[n],e.allPassFeedback).callback)},Gibberish.Reverb.prototype=Gibberish._effect,Gibberish.Granulator=function(e){var t=[];buffer=null,interpolate=Gibberish.interpolate,panner=Gibberish.makePanner(),bufferLength=0,debug=0,write=0,self=this,out=[0,0],_out=[0,0],rndf=Gibberish.rndf,numberOfGrains=e.numberOfGrains||20,Gibberish.extend(this,{name:"granulator",bufferLength:88200,reverse:!0,spread:.5,properties:{speed:1,speedMin:0,speedMax:0,grainSize:1e3,position:.5,positionMin:0,positionMax:0,amp:.2,fade:.1,pan:0,shouldWrite:!1},callback:function(e,i,r,n,s,o,a,h,b,l){for(var u=0;numberOfGrains>u;u++){var p=t[u];if(p._speed>0){p.pos>p.end&&(p.pos=(a+rndf(s,o))*buffer.length,p.start=p.pos,p.end=p.start+n,p._speed=e+rndf(i,r),p._speed=.1>p._speed?.1:p._speed,p._speed=.1>p._speed&&p._speed>0?.1:p._speed,p._speed=p._speed>-.1&&0>p._speed?-.1:p._speed,p.fadeAmount=p._speed*b*n,p.pan=rndf(-1*self.spread,self.spread));
for(var c=p.pos;c>buffer.length;)c-=buffer.length;for(;0>c;)c+=buffer.length;var d=interpolate(buffer,c);d*=p.pos<p.fadeAmount+p.start?(p.pos-p.start)/p.fadeAmount:1,d*=p.pos>p.end-p.fadeAmount?(p.end-p.pos)/p.fadeAmount:1}else{p.pos<p.end&&(p.pos=(a+rndf(s,o))*buffer.length,p.start=p.pos,p.end=p.start-n,p._speed=e+rndf(i,r),p._speed=.1>p._speed&&p._speed>0?.1:p._speed,p._speed=p._speed>-.1&&0>p._speed?-.1:p._speed,p.fadeAmount=p._speed*b*n);for(var c=p.pos;c>buffer.length;)c-=buffer.length;for(;0>c;)c+=buffer.length;var d=interpolate(buffer,c);d*=p.pos>p.start-p.fadeAmount?(p.start-p.pos)/p.fadeAmount:1,d*=p.pos<p.end+p.fadeAmount?(p.end-p.pos)/p.fadeAmount:1}_out=panner(d*h,p.pan,_out),out[0]+=_out[0],out[1]+=_out[1],p.pos+=p._speed}return panner(out,l,out)}}).init().processProperties(arguments);for(var i=0;numberOfGrains>i;i++)t[i]={pos:self.position+Gibberish.rndf(self.positionMin,self.positionMax),_speed:self.speed+Gibberish.rndf(self.speedMin,self.speedMax)},t[i].start=t[i].pos,t[i].end=t[i].pos+self.grainSize,t[i].fadeAmount=t[i]._speed*self.fade*self.grainSize,t[i].pan=Gibberish.rndf(-1*self.spread,self.spread);e.input!==void 0?(that.shouldWrite=!0,that.sampler=new Gibberish.Sampler,that.sampler.connect(),that.sampler.record(e.buffer,that.bufferLength),that.buffer=that.sampler.buffer):e.buffer!==void 0&&(buffer=e.buffer,bufferLength=buffer.length)},Gibberish.Granulator.prototype=Gibberish._effect,Gibberish.synth=function(){this.type="oscillator",this.oscillatorInit=function(){this.fx=new Array2,this.fx.parent=this}},Gibberish.synth.prototype=new Gibberish.ugen,Gibberish._synth=new Gibberish.synth,Gibberish.Synth=function(){this.name="synth",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,glide:.15,amp:.25,channels:2,pan:0},this.note=function(t,i){this.frequency=t,_frequency=t,i!==void 0&&(this.amp=i),e.run()};var e=new Gibberish.AD,t=e.getState,i=e.callback,r=new Gibberish.PWM,n=r.callback,s=(new Gibberish.OnePole).callback,o=Gibberish.makePanner(),a=[0,0];this.callback=function(e,r,h,b,l,u,p,c){if(l=l>=1?.99999:l,e=s(e,1-l,l),2>t()){var d=i(h,b),f=n(e,1,r)*d*u;return a[0]=a[1]=f,1===p?f:o(f,c,a)}return f=a[0]=a[1]=0,1===p?f:o(f,c,a)},this.getOsc=function(){return r},this.setOsc=function(e){r=e,n=r.callback};var h="PWM";Object.defineProperty(this,"waveform",{get:function(){return h},set:function(e){this.setOsc(new Gibberish[e])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth.prototype=Gibberish._synth,Gibberish.PolySynth=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polysynth",maxVoices:5,voiceCount:0,polyProperties:{glide:0,attack:22050,decay:22050,pulsewidth:.5,waveform:"PWM"},note:function(e,t){var i=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),i.note(e,t)}}),this.amp=1/this.maxVoices,this.processProperties(arguments),this.children=[],this.dirty=!0;for(var e=0;this.maxVoices>e;e++){var t={attack:this.attack,decay:this.decay,pulsewidth:this.pulsewidth,channels:2,amp:1},i=new Gibberish.Synth(t);i.connect(this),this.children.push(i)}Gibberish.polyInit(this),Gibberish._synth.oscillatorInit.call(this)},Gibberish.Synth2=function(){this.name="synth2",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,cutoff:.25,resonance:3.5,useLowPassFilter:!0,glide:.15,amp:.25,channels:1,pan:0},this.note=function(t,i){this.frequency=t,_frequency=t,i!==void 0&&(this.amp=i),e.run()};var e=new Gibberish.AD,t=e.getState,i=e.callback,r=new Gibberish.PWM,n=r.callback,s=new Gibberish.Filter24,o=s.callback,a=(new Gibberish.OnePole).callback,h=Gibberish.makePanner(),b=[0,0];this.callback=function(e,r,s,l,u,p,c,d,f,m,g){if(2>t()){d=d>=1?.99999:d,e=a(e,1-d,d);var y=i(s,l),v=o(n(e,.15,r),u*y,p,c)*y*f;return b[0]=b[1]=v,1===m?v:h(v,g,b)}return v=b[0]=b[1]=0,1===m?v:h(v,g,b)},this.getOsc=function(){return r},this.setOsc=function(e){r=e,n=r.callback};var l="PWM";Object.defineProperty(this,"waveform",{get:function(){return l},set:function(e){this.setOsc(new Gibberish[e])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth2.prototype=Gibberish._synth,Gibberish.FMSynth=function(){this.name="fmSynth",this.properties={frequency:0,cmRatio:2,index:5,attack:22050,decay:22050,glide:.15,amp:.25,channels:2,pan:0},this.note=function(t,i){this.frequency=t,_frequency=t,i!==void 0&&(this.amp=i),e.run()};var e=new Gibberish.AD,t=e.getState,i=e.callback,r=(new Gibberish.Sine).callback,n=(new Gibberish.Sine).callback,s=(new Gibberish.OnePole).callback,o=Gibberish.makePanner(),a=[0,0];this.callback=function(e,h,b,l,u,p,c,d,f){if(2>t()){p>=1&&(p=.9999),e=s(e,1-p,p);var m=i(l,u),g=n(e*h,e*b,1,1)*m,y=r(e+g,1,1)*m*c;return a[0]=a[1]=y,1===d?y:o(y,f,a)}return y=a[0]=a[1]=0,1===d?y:o(y,f,a)},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.FMSynth.prototype=Gibberish._synth,Gibberish.PolyFM=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polyfm",maxVoices:5,voiceCount:0,children:[],polyProperties:{glide:0,attack:22050,decay:22050,index:5,cmRatio:2},note:function(e,t){var i=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),i.note(e,t)}}),this.amp=1/this.maxVoices,this.processProperties(arguments);for(var e=0;this.maxVoices>e;e++){var t={attack:this.attack,decay:this.decay,cmRatio:this.cmRatio,index:this.index,channels:2,amp:1},i=new Gibberish.FMSynth(t);i.connect(this),this.children.push(i)}Gibberish.polyInit(this),Gibberish._synth.oscillatorInit.call(this)},AudioFileRequest.prototype.onSuccess=function(){},AudioFileRequest.prototype.onFailure=function(){},AudioFileRequest.prototype.send=function(){if("wav"!=this.extension&&"aiff"!=this.extension&&"aif"!=this.extension)return this.onFailure(),void 0;var e=new XMLHttpRequest;e.open("GET",this.url,this.async),e.overrideMimeType("text/plain; charset=x-user-defined"),e.onreadystatechange=function(){4==e.readyState&&(200==e.status||0==e.status?this.handleResponse(e.responseText):this.onFailure())}.bind(this),e.send(null)},AudioFileRequest.prototype.handleResponse=function(e){var t,i;"wav"==this.extension?(t=new WAVDecoder,i=t.decode(e)):("aiff"==this.extension||"aif"==this.extension)&&(t=new AIFFDecoder,i=t.decode(e)),this.onSuccess(i)},Decoder.prototype.readString=function(e,t,i){return e.slice(t,t+i)},Decoder.prototype.readIntL=function(e,t,i){for(var r=0,n=0;i>n;n++)r+=(255&e.charCodeAt(t+n))*Math.pow(2,8*n);return r},Decoder.prototype.readChunkHeaderL=function(e,t){var i={};return i.name=this.readString(e,t,4),i.length=this.readIntL(e,t+4,4),i},Decoder.prototype.readIntB=function(e,t,i){for(var r=0,n=0;i>n;n++)r+=(255&e.charCodeAt(t+n))*Math.pow(2,8*(i-n-1));return r},Decoder.prototype.readChunkHeaderB=function(e,t){var i={};return i.name=this.readString(e,t,4),i.length=this.readIntB(e,t+4,4),i},Decoder.prototype.readFloatB=function(e,t){var i=this.readIntB(e,t,2),r=32768;i>=r&&(i|=~(r-1));var n=1;0>i&&(n=-1,i+=r);var s,o=this.readIntB(e,t+2,4),a=this.readIntB(e,t+6,4);return 0==(i==o==a)?s=0:32767==i?s=Number.MAX_VALUE:(i-=16383,s=(4294967296*o+a)*Math.pow(2,i-63)),n*s},WAVDecoder.prototype.__proto__=Decoder.prototype,WAVDecoder.prototype.decode=function(e){var t={},i=0,r=this.readChunkHeaderL(e,i);if(i+=8,"RIFF"!=r.name)return console.error("File is not a WAV"),null;var n=r.length;n+=8;var s=this.readString(e,i,4);if(i+=4,"WAVE"!=s)return console.error("File is not a WAV"),null;for(;n>i;){var r=this.readChunkHeaderL(e,i);if(i+=8,"fmt "==r.name){var o=this.readIntL(e,i,2);if(i+=2,1!=o)return console.error("Cannot decode non-PCM encoded WAV file"),null;var a=this.readIntL(e,i,2);i+=2;var h=this.readIntL(e,i,4);i+=4,i+=4,i+=2;var b=this.readIntL(e,i,2),l=b/8;i+=2}else if("data"==r.name){for(var u=r.length/(l*a),p=[],c=0;a>c;c++)p.push(new Float32Array(u));for(var c=0;a>c;c++)for(var d=p[c],f=0;u>f;f++){var m=i;m+=(f*a+c)*l;var g=this.readIntL(e,m,l),y=1<<b-1;g>=y&&(g|=~(y-1)),d[f]=g/y}i+=r.length}else i+=r.length}return t.sampleRate=h,t.bitDepth=b,t.channels=p,t.length=u,t},AIFFDecoder.prototype.__proto__=Decoder.prototype,AIFFDecoder.prototype.decode=function(e){var t={},i=0,r=this.readChunkHeaderB(e,i);if(i+=8,"FORM"!=r.name)return console.error("File is not an AIFF"),null;var n=r.length;n+=8;var s=this.readString(e,i,4);if(i+=4,"AIFF"!=s)return console.error("File is not an AIFF"),null;for(;n>i;){var r=this.readChunkHeaderB(e,i);if(i+=8,"COMM"==r.name){var o=this.readIntB(e,i,2);i+=2;var a=this.readIntB(e,i,4);i+=4;for(var h=[],b=0;o>b;b++)h.push(new Float32Array(a));var l=this.readIntB(e,i,2),u=l/8;i+=2;var p=this.readFloatB(e,i);i+=10}else if("SSND"==r.name){var c=this.readIntB(e,i,4);i+=4,i+=4,i+=c;for(var b=0;o>b;b++)for(var d=h[b],f=0;a>f;f++){var m=i;m+=(f*o+b)*u;var g=this.readIntB(e,m,u),y=1<<l-1;g>=y&&(g|=~(y-1)),d[f]=g/y}i+=r.length-c-8}else i+=r.length}return t.sampleRate=p,t.bitDepth=l,t.channels=h,t.length=a,t},Gibberish.Sampler=function(){var e=1,t=Gibberish.interpolate,i=Gibberish.makePanner(),r=[0,0],n=null,s=1,o=this;if(Gibberish.extend(this,{name:"sampler",file:null,isLoaded:!1,playOnLoad:0,properties:{pitch:1,amp:1,isRecording:!1,isPlaying:!0,input:0,length:0,start:0,end:1,loops:0,pan:0},_onload:function(t){n=t.channels[0],s=t.length,o.end=s,o.length=e=s,console.log("LOADED ",o.file,s),Gibberish.audioFiles[o.file]=n,o.onload&&o.onload(),0!==o.playOnLoad&&o.note(o.playOnLoad),o.isLoaded=!0},note:function(t,i){"number"==typeof i&&(this.amp=i),this.pitch=t,null!==this.function&&(this.isPlaying=!0,e=t>0?this.start:this.end)},record:function(t,i){this.isRecording=!0;var r=this;new Gibberish.Record(t,i,function(){n=this.getBuffer(),r.end=s=n.length,e=r.end,r.isRecording=!1}).record()},getBuffer:function(){return n},callback:function(s,o,a,h,b,l,u,p,c,d){var f=0;return e+=s,p>e&&e>0?(s>0?f=null!==n&&h?t(n,e):0:e>u?f=null!==n&&h?t(n,e):0:e=c?p:e,i(f,d,r)):(e=c&&s>0?u:e,e=c&&0>s?p:e,r[0]=r[1]=f,r)}}).init().oscillatorInit().processProperties(arguments),arguments[0]!==void 0&&("string"==typeof arguments[0]?(console.log("SETTING FILE"),this.file=arguments[0],delete arguments[0]):"object"==typeof arguments[0]&&arguments[0].file&&(this.file=arguments[0].file)),console.log(this),Gibberish.audioFiles[this.file]!==void 0)n=Gibberish.audioFiles[this.file],this.end=this.bufferLength=n.length,e=this.bufferLength,Gibberish.dirty(this),this.onload&&this.onload();else if(null!==this.file){var a=new AudioFileRequest(this.file);a.onSuccess=this._onload,a.send()}else this.buffer!==void 0&&(this.isLoaded=!0,n=this.buffer,this.end=this.bufferLength=n.length,e=this.bufferLength,arguments[0]&&arguments[0].loops&&(this.loops=1),Gibberish.dirty(this),this.onload&&this.onload())},Gibberish.Sampler.prototype=Gibberish._oscillator,Gibberish.MonoSynth=function(){Gibberish.extend(this,{name:"monosynth",properties:{frequency:0,amp1:1,amp2:1,amp3:1,attack:1e4,decay:1e4,cutoff:.2,resonance:2.5,filterMult:.3,isLowPass:!0,amp:.6,detune2:.01,detune3:-.01,octave2:1,octave3:-1,glide:0,pan:0,channels:1},waveform:"Saw",note:function(e){this.frequency=e,i()>0&&t.run()}});var e=this.waveform;Object.defineProperty(this,"waveform",{get:function(){return e},set:function(t){e!==t&&(e=t,s=(new Gibberish[t]).callback,o=(new Gibberish[t]).callback,a=(new Gibberish[t]).callback)}});var t=new Gibberish.AD(this.attack,this.decay),i=t.getState,r=t.callback,n=(new Gibberish.Filter24).callback,s=new Gibberish[this.waveform](this.frequency,this.amp1).callback,o=new Gibberish[this.waveform](this.frequency2,this.amp2).callback,a=new Gibberish[this.waveform](this.frequency3,this.amp3).callback,h=(new Gibberish.OnePole).callback,b=Gibberish.makePanner(),l=[0,0];this.callback=function(e,t,u,p,c,d,f,m,g,y,v,G,k,w,_,P,S,A){if(2>i()){P>=1&&(P=.9999),e=h(e,1-P,P);var x=e;if(w>0)for(var M=0;w>M;M++)x*=2;else if(0>w)for(var M=0;M>w;M--)x/=2;var C=e;if(_>0)for(var M=0;_>M;M++)C*=2;else if(0>_)for(var M=0;M>_;M--)C/=2;x+=G>0?(2*e-e)*G:(e-e/2)*G,C+=k>0?(2*e-e)*k:(e-e/2)*k;var F=s(e,t,1)+o(x,u,1)+a(C,p,1),I=r(c,d),D=n(F,f+g*I,m,y,1)*I;return D*=v,l[0]=l[1]=D,1===A?l:b(D,S,l)}return l[0]=l[1]=0,l},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.MonoSynth.prototype=Gibberish._synth,Gibberish.Expressions={add:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"add",properties:{},callback:function(e,t){return e+t}};t.__proto__=new Gibberish.ugen;for(var i=0;e.length>i;i++)t.properties[i]=e[i];return t.init(),t},sub:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"sub",properties:{},callback:function(e,t){return e-t}};t.__proto__=new Gibberish.ugen;for(var i=0;e.length>i;i++)t.properties[i]=e[i];return t.init(),t},mul:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"mul",properties:{},callback:function(e,t){return e*t}};t.__proto__=new Gibberish.ugen;for(var i=0;e.length>i;i++)t.properties[i]=e[i];return t.init(),t},div:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"div",properties:{},callback:function(e,t){return e/t}};t.__proto__=new Gibberish.ugen;for(var i=0;e.length>i;i++)t.properties[i]=e[i];return t.init(),t},abs:function(){Array.prototype.slice.call(arguments,0),Math.abs;var e={name:"abs",properties:{},callback:Math.abs};return e.__proto__=new Gibberish.ugen,e.properties[0]=arguments[0],e.init(),e},mod:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"mod",properties:{},callback:function(e,t){return e%t}};t.__proto__=new Gibberish.ugen;for(var i=0;e.length>i;i++)t.properties[i]=e[i];return t.init(),t},sqrt:function(){Array.prototype.slice.call(arguments,0),_sqrt=Math.sqrt;var e={name:"sqrt",properties:{},callback:Math.sqrt};return e.__proto__=new Gibberish.ugen,e.properties[i]=arguments[0],e.init(),e},pow:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"pow",properties:{},callback:Math.pow};t.__proto__=new Gibberish.ugen;for(var i=0;e.length>i;i++)t.properties[i]=e[i];return t.init(),t}},Gibberish.docs={Gibberish:{text:'<h1 id="gibberish">Gibberish</h1>\n\n<p>Gibberish is the main object used to manage the audio graph and perform codegen functions. All constructors are also inside of the Gibberish object. Gibberish can automatically generate an appropriate web audio callback for you; if you want to use this you must execute the Gibberish.init() command before creating any Gibberish ugens.</p>\n\n<h2 id="exampleusage">Example Usage</h2>\n\n<p><code>// make a sine wave <br />\nGibberish.init(); <br />\na = new Gibberish.Sine().connect();</code></p>\n\n<h2 id="constructor">Constructor</h2>\n\n<p><strong>param</strong> <em>bufferSize</em>: Integer. Default 1024. The size of the buffer to be calculated. Since JavaScript is single-threaded, setting exceedingly large values for this will yield to stuttering in graphics and user interface performance.</p>\n\n<hr />',methods:{createCallback:'<h3 id="gibberishcreatecallbackmethod">Gibberish.createCallback : method</h3>\n\n<p>Perform codegen on all dirty ugens and re-create the audio callback. This method is called automatically in the default Gibberish sample loop whenever Gibberish.isDirty is true.</p>',audioProcess:'<h3 id="gibberishaudioprocessmethod">Gibberish.audioProcess : method</h3>\n\n<p>The default audio callback used in Webkit browsers. This callback starts running as soon as Gibberish.init() is called.  </p>\n\n<p>param <strong>Audio Event</strong> : Object. The HTML5 audio event object.</p>',audioProcessFirefox:'<h3 id="gibberishaudioprocessfirefoxmethod">Gibberish.audioProcessFirefox : method</h3>\n\n<p>The default audio callback used in Firefox. This callback starts running as soon as Gibberish.init() is called.  </p>\n\n<p>param <strong>Sound Data</strong> : Object. The buffer of audio data to be filled</p>',clear:'<h3 id="gibberishclearmethod">Gibberish.clear : method</h3>\n\n<p>Remove all objects from Gibberish graph and perform codegen... kills all running sound and CPU usage.</p>',dirty:"<h3 id=\"gibberishdirtymethod\">Gibberish.dirty : method</h3>\n\n<p>Tell Gibberish a ugen needs to be codegen'd and mark the entire callback as needing regeneration  </p>\n\n<p>param <strong>Ugen</strong> : Object. The ugen that is 'dirtied'... that has a property value changed.</p>",generateSymbol:'<h3 id="gibberishgeneratesymbolmethod">Gibberish.generateSymbol : method</h3>\n\n<p>Generate a unique symbol for a given ugen using its name and a unique id number.  </p>\n\n<p>param <strong>name</strong> : String. The name of the ugen; for example, reverb, delay etc.</p>',AudioDataDestination:'<h3 id="gibberishaudiodatadestinationmethod">Gibberish.AudioDataDestination : method</h3>\n\n<p>Create a callback and start it running. Note that in iOS audio callbacks can only be created in response to user events. Thus, in iOS this method assigns an event handler to the HTML body that creates the callback as soon as the body is touched; at that point the event handler is removed. </p>',makePanner:'<h3 id="gibberishmakepannermethod">Gibberish.makePanner : method</h3>\n\n<p>Create and return an object that can be used to pan a stereo source.</p>',polyInit:"<h3 id=\"gibberishpolyinitmethod\">Gibberish.polyInit : method</h3>\n\n<p>For ugens with polyphony, add metaprogramming that passes on property changes to the 'children' of the polyphonic object. Polyphonic ugens in Gibberish are just single instances that are routed into a shared bus, along with a few special methods for voice allocation etc.  </p>\n\n<p>param <strong>Ugen</strong> : Object. The polyphonic ugen</p>",interpolate:'<h3 id="gibberishinterpolatemethod">Gibberish.interpolate : method</h3>\n\n<p>Similiar to makePanner, this method returns a function that can be used to linearly interpolate between to values. The resulting function takes an array and a floating point position index and returns a value.</p>',ugen:'<h3 id="gibberishugenmethod">Gibberish.ugen : method</h3>\n\n<p>Creates a prototype object that is used by all ugens.</p>'},properties:{audioFiles:'<h3 id="gibberishaudiofilesproperty">Gibberish.audioFiles : property</h3>\n\n<p>Array. Anytime an audiofile is loaded (normally using the Sampler ugen) the resulting sample buffer is stored in this array so that it can be immediately recalled.</p>',callback:'<h3 id="gibberishcallbackproperty">Gibberish.callback : property</h3>\n\n<p>String. Whenever Gibberish performs code generation the resulting callback is stored here.</p>',out:"<h3 id=\"gibberishoutproperty\">Gibberish.out : property</h3>\n\n<p>Object. The is the 'master' bus that everything eventually gets routed to if you're using the auto-generated calback. This bus is initialized in the call to Gibberish.init.</p>",dirtied:'<h3 id="gibberishdirtiedproperty">Gibberish.dirtied : property</h3>\n\n<p>Array. A list of objects that need to be codegen\'d</p>',isDirty:'<h3 id="gibberishisdirtyproperty">Gibberish.isDirty : property</h3>\n\n<p>Booelan. Whether or codegen should be performed.</p>',codeblock:"<h3 id=\"gibberishcodeblockproperty\">Gibberish.codeblock : property</h3>\n\n<p>Array. During codegen, each ugen's codeblock is inserted into this array. Once all the ugens have codegen'd, the array is concatenated to form the callback.</p>",upvalues:"<h3 id=\"gibberishupvaluesproperty\">Gibberish.upvalues : property</h3>\n\n<p>Array. Each ugen's callback function is stored in this array; the contents of the array become upvalues to the master callback function when it is codegen'd.</p>",debug:'<h3 id="gibberishdebugproperty">Gibberish.debug : property</h3>\n\n<p>Boolean. Default false. When true, the callbackString is printed to the console whenever a codegen is performed</p>',memo:'<h3 id="gibberishmemoproperty">Gibberish.memo : property</h3>\n\n<p>Object. Used in the codegen process to make sure codegen for each ugen is only performed once.</p>',Sine:'<h3 id="gibberishsinecallbackmethod">Gibberish.Sine.callback : method</h3>\n\n<p>Returns a single sample of output.  </p>\n\n<p>param <strong>frequency</strong> Number. The frequency to be used to calculate output. <br />\nparam <strong>amp</strong> Number. The amplitude to be used to calculate output.  </p>',Sine2:'<h3 id="gibberishsine2panproperty">Gibberish.Sine2.pan : property</h3>\n\n<p>Number. -1..1. The position of the sinewave in the stereo spectrum</p>',Saw:'<h3 id="gibberishsawampproperty">Gibberish.Saw.amp : property</h3>\n\n<p>Number. A linear value specifying relative amplitude, ostensibly from 0..1 but can be higher, or lower when used for modulation.</p>',Triangle:'<h3 id="gibberishtriangleampproperty">Gibberish.Triangle.amp : property</h3>\n\n<p>Number. A linear value specifying relative amplitude, ostensibly from 0..1 but can be higher, or lower when used for modulation.</p>',Saw3:'<h3 id="gibberishsaw3ampproperty">Gibberish.Saw3.amp : property</h3>\n\n<p>Number. A linear value specifying relative ampltiude, ostensibly from 0..1 but can be higher, or lower when used for modulation.</p>',PWM:'<h3 id="gibberishpwmpulsewidthproperty">Gibberish.PWM.pulsewidth : property</h3>\n\n<p>Number. 0..1. The width of the waveform\'s duty cycle.</p>',Noise:'<h3 id="gibberishnoiseampproperty">Gibberish.Noise.amp : property</h3>\n\n<p>Number. A linear value specifying relative amplitude, ostensibly from 0..1 but can be higher, or lower when used for modulation.</p>',KarplusStrong:'<h3 id="gibberishkarplusstrongpanproperty">Gibberish.KarplusStrong.pan : property</h3>\n\n<p>Number. Default 0. The position in the stereo spectrum for the sound, from -1..1.</p>'},type:"Miscellaneous"},Ugen:{text:'<h1 id="ugen">Ugen</h1>\n\n<p>The prototype object that all ugens inherit from</p>',methods:{processProperties:'<h3 id="ugenprocesspropertiesmethod">Ugen.processProperties : method</h3>\n\n<p>Used to assign and process arguments passed to the constructor functions of ugens.  </p>\n\n<p>param <strong>argumentList</strong> : Array. A list of arguments (may be a single dictionary) passed to a ugen constructor.</p>',codegen:'<h3 id="ugencodegenmethod">Ugen.codegen : method</h3>\n\n<p>Generates output code (as a string) used inside audio callback</p>',getCodeblock:'<h3 id="ugengetcodeblockmethod">Ugen.getCodeblock : method</h3>\n\n<p>Retrieves codeblock for ugen previously created with codegen method.</p>',defineUgenProperty:'<h3 id="ugendefineugenpropertymethod">Ugen.defineUgenProperty : method</h3>\n\n<p>Creates getters and setters for ugen properties that automatically dirty the ugen whenever the property value is changed.  </p>\n\n<p>param <strong>key</strong> : String. The name of a property to add getter / setters for. <br />\nparam <strong>value</strong> : Any. The initival value to set the property to</p>',init:'<h3 id="ugeninitmethod">Ugen.init : method</h3>\n\n<p>Initialize ugen by calling defineUgenProperty for every key in the ugen\'s properties dictionary, generating a unique id for the ugen and various other small tasks.</p>',mod:'<h3 id="ugenmodmethod">Ugen.mod : method</h3>\n\n<p>Modulate a property of a ugen on a per-sample basis.  </p>\n\n<p>param <strong>key</strong> : String. The name of the property to modulate <br />\nparam <strong>value</strong> : Any. The object or number value to modulate the property with <br />\nparam <strong>op</strong> : String. Default "+". The operation to perform. Can be +,-,*,/,= or ++. ++ adds and returns the absolute value.</p>',removeMod:'<h3 id="ugenremovemodmethod">Ugen.removeMod : method</h3>\n\n<p>Remove a modulation from a ugen.  </p>\n\n<p>param <strong>key</strong> : String. The name of the property to remove the modulation from <br />\nparam <strong>arg</strong> : Number or Object. Optional. This determines which modulation to remove if more than one are assigned to the property. If this argument is undefined, all modulations are removed. If the argument is a number, the number represents a modulation in the order that they were applied (an array index). If the argument is an object, it removes a modulation that\nis using a matching object as the modulator.</p>',polyMod:'<h3 id="ugenpolymodmethod">Ugen.polyMod : method</h3>\n\n<p>Applies a modulation to all children of a polyphonic ugen  </p>\n\n<p>param <strong>key</strong> : String. The name of the property to modulate <br />\nparam <strong>value</strong> : Any. The object or number value to modulate the property with <br />\nparam <strong>op</strong> : String. Default "+". The operation to perform. Can be +,-,*,/,= or ++. ++ adds and returns the absolute value.</p>',removePolyMod:'<h3 id="ugenremovepolymodmethod">Ugen.removePolyMod : method</h3>\n\n<p>Removes a modulation from all children of a polyphonic ugen. The arguments  </p>\n\n<p>param <strong>arg</strong> : Number or Object. Optional. This determines which modulation to remove if more than one are assigned to the property. If this argument is undefined, all modulations are removed. If the argument is a number, the number represents a modulation in the order that they were applied (an array index). If the argument is an object, it removes a modulation that\nis using a matching object as the modulator.</p>',connect:'<h3 id="ugenconnectmethod">Ugen.connect : method</h3>\n\n<p>Connect the output of a ugen to a bus.  </p>\n\n<p>param <strong>bus</strong> : Bus ugen. Optional. The bus to connect the ugen to. If no argument is passed the ugen is connect to Gibberish.out. Gibberish.out is automatically created when Gibberish.init() is called and can be thought of as the master stereo output for Gibberish.</p>',send:'<h3 id="ugensendmethod">Ugen.send : method</h3>\n\n<p>Send an arbitrary amount of output to a bus  </p>\n\n<p>param <strong>bus</strong> : Bus ugen. The bus to send the ugen to. <br />\nparam <strong>amount</strong> : Float. The amount of signal to send to the bus. </p>',disconnect:'<h3 id="ugendisconnectmethod">Ugen.disconnect : method</h3>\n\n<p>Disconnect a ugen from a bus (or all busses). This stops all audio and signal processing for the ugen.  </p>\n\n<p>param <strong>bus</strong> : Bus ugen. Optional. The bus to send the ugen to. If this argument is undefined the ugen will be disconnected from all busses.</p>'},properties:{},type:"Miscellaneous"}};